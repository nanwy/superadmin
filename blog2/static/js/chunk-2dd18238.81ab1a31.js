(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2dd18238"],{2423:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return s}));var o=n("b775");function r(e,t){return Object(o["a"])({url:"/api/blog/list",method:"get",params:{ordername:e,orderby:t}})}function a(e,t){return Object(o["a"])({url:"/api/blog/detail",method:"get",params:{id:e,title:t}})}function i(e){return Object(o["a"])({url:"/api/blog/new",method:"post",data:e})}function l(e){return Object(o["a"])({url:"/api/blog/update",method:"post",data:e})}function s(e){return Object(o["a"])({url:"/api/article/del",method:"get",params:{id:e}})}},"24d7":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("tinymceeditor",{attrs:{init:e.init},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)},r=[],a=(n("e562"),n("ca72")),i=(n("4ea8"),n("4237"),n("84ec"),n("0902"),n("0a9d"),n("69e4"),n("2b07"),n("62e5"),n("07d1"),n("9434"),n("07d7"),n("4bd0"),{components:{tinymceeditor:a["a"]},data:function(){return{content:"",init:{language_url:"/tinymce/zh_CN.js",language:"zh_CN",theme_url:"/tinymce/themes/silver/theme.min.js",skin_url:"/tinymce/skins/ui/oxide",height:300,content_css:["/tinymce/skins/content/default/content.css"],emoticons_database_url:"tinymce/plugins/emoticons/js/emojis.js",images_upload_handler:function(e,t,n){console.log(e)},plugins:"insertdatetime lists advlist image link preview emoticons hr searchreplace table wordcount codesample",toolbar:"undo redo | formatselect | forecolor backcolor | bold italic underline strikethrough blockquote codesample | image link table emoticons hr insertdatetime | alignleft aligncenter alignright alignjustify | bullist numlist | outdent indent | wordcount | searchreplace| preview",branding:!0}}},watch:{content:function(e,t){this.content=e}},methods:{}}),l=i,s=n("2877"),c=Object(s["a"])(l,o,r,!1,null,"18d252a8",null);t["a"]=c.exports},3123:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}));var o=n("b775");function r(){return Object(o["a"])({url:"/api/qiniu/token",method:"get"})}function a(e){return Object(o["a"])({url:"/api/qiniu/del",method:"get",params:{filename:e}})}},"816e":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("mavon-editor",{ref:"md",model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)},r=[],a=n("b2d8"),i=(n("64e1"),{components:{mavonEditor:a["mavonEditor"]},data:function(){return{content:""}}}),l=i,s=n("2877"),c=Object(s["a"])(l,o,r,!1,null,"d177b5ae",null);t["a"]=c.exports},b0a8:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"id",hidden:""}},[n("el-input",{model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"标题"}},[n("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"分类"}},[n("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"内容"}},[n("markdown",{ref:"con"})],1),e._v(" "),n("el-form-item",{attrs:{label:"时间",prop:"date"}},[n("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"封面图"}},[n("el-upload",{staticClass:"upload-demo",attrs:{"http-request":e.handleUpload,"on-remove":e.handleRemove,"on-exceed":e.handleExceed,"list-type":"picture-card",action:"","file-list":e.oldimg,limit:1}},[n("i",{staticClass:"el-icon-plus"})]),e._v("\n      "+e._s(this.newimg)+"\n      "),e._v(" "),n("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.jindu}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"success"},on:{click:function(t){return e.onSubmit()}}},[e._v("点击修改")])],1)],1)],1)},r=[],a=(n("7f7f"),n("96cf"),n("1da1")),i=n("bc3a"),l=n.n(i),s=n("24d7"),c=n("816e"),u=n("2423"),m=(n("3123"),n("cea2"),{components:{tinymce1:s["a"],markdown:c["a"]},data:function(){return{form:{id:"",title:"",type:"",content:"",date:"",img:null},oldimg:[],newimg:null,rules:{date:[{required:!0,message:"请填写日期时间"}]},token:"",jindu:0}},mouted:function(){},created:function(){var e=this;Object(u["e"])(this.$route.params.id).then((function(t){console.log(t,e.$store.state.user.role),e.form.id=t.data.id,e.form.title=t.data.title,e.form.type=t.data.type,e.$refs["con"].content=t.data.content,e.form.date=t.data.createtime,e.form.date=e.dateFormat(e.form.date),t.list.rows[0].img&&(console.log(t.list.rows[0].img),console.log("121111111111111"),e.oldimg.push({name:t.list.rows[0].img,url:t.list.rows[0].img}),console.log(e.oldimg[0].url),e.newimg=t.list.rows[0].img,console.log("==========="))})).catch((function(e){console.log(e)}))},methods:{dateFormat:function(e){var t=new Date(e),n=t.getFullYear(),o=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate(),a=t.getHours()<10?"0"+t.getHours():t.getHours(),i=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),l=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return n+"-"+o+"-"+r+" "+a+":"+i+":"+l},handleUpload:function(e){var t=new FormData;t.append("avatar",e.file),console.log(e.file),this.newimg=t},handleRemove:function(){this.newimg=null},handleExceed:function(){this.$message({message:"只能上传一张封面图",type:"error"})},editarticle:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("开始修改文章"),console.log(this.$refs.form.model),e.next=4,Object(u["d"])(t);case 4:n=e.sent,console.log(n),console.log("修改文章完成！"),this.$message({message:n,type:"success"});case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onSubmit:function(){var e=this;this.form.content=this.$refs.con.content,this.$refs["form"].validate(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){var o,r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=48;break}if(console.log("表单验证通过！",e.$store.state.user.role),"admin"==e.$store.state.user.role){t.next=6;break}e.$message({message:"您没权限修改哦~",type:"warning"}),t.next=46;break;case 6:if(0!=e.oldimg.length){t.next=26;break}if(null==e.newimg){t.next=21;break}return console.log(e.newimg),console.log,console.log("原本没有封面图的不用删直接上传新封面图，再修改数据库"),o={headers:{"Content-Type":"multipart/form-data"}},t.next=14,l.a.post("/api/upload",e.newimg,o);case 14:return r=t.sent,a=r.data.file.filename,e.form.img="/api/"+a,t.next=19,e.editarticle(e.form);case 19:t.next=24;break;case 21:console.log("111111111"),e.form.img=null,e.editarticle(e.form);case 24:t.next=46;break;case 26:if(console.log("sssssssssssssss"),console.log(e.oldimg[0].name),console.log(e.newimg),null==e.newimg&&(console.log("如果只删除七牛云图片，除了修改数据库还要把七牛云图片删了"),e.form.img=null,e.editarticle(e.form)),e.oldimg[0].name==e.newimg){t.next=42;break}return console.log("22222222222222"),i={headers:{"Content-Type":"multipart/form-data"}},t.next=35,l.a.post("/api/upload",e.newimg,i);case 35:return r=t.sent,a=r.data.file.filename,e.form.img="/api/"+a,t.next=40,e.editarticle(e.form);case 40:t.next=46;break;case 42:console.log("sdfsdgd"),console.log(e.oldimg[0].name),e.form.img=e.oldimg[0].name,e.editarticle(e.form);case 46:t.next=50;break;case 48:return alert("请填写完整！"),t.abrupt("return",!1);case 50:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}}),d=m,f=n("2877"),g=Object(f["a"])(d,o,r,!1,null,null,null);t["default"]=g.exports}}]);