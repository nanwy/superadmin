(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f7b6f02c"],{2423:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return s}));var o=n("b775");function a(e,t){return Object(o["a"])({url:"/api/blog/list",method:"get",params:{ordername:e,orderby:t}})}function r(e,t){return Object(o["a"])({url:"/api/blog/detail",method:"get",params:{id:e,title:t}})}function i(e){return Object(o["a"])({url:"/api/blog/new",method:"post",data:e})}function l(e){return Object(o["a"])({url:"/api/blog/update",method:"post",data:e})}function s(e){return Object(o["a"])({url:"/api/blog/del",method:"get",params:{id:e}})}},"24d7":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("tinymceeditor",{attrs:{init:e.init},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)},a=[],r=(n("e562"),n("ca72")),i=(n("4ea8"),n("4237"),n("84ec"),n("0902"),n("0a9d"),n("69e4"),n("2b07"),n("62e5"),n("07d1"),n("9434"),n("07d7"),n("4bd0"),{components:{tinymceeditor:r["a"]},data:function(){return{content:"",init:{language_url:"/tinymce/zh_CN.js",language:"zh_CN",theme_url:"/tinymce/themes/silver/theme.min.js",skin_url:"/tinymce/skins/ui/oxide",height:300,content_css:["/tinymce/skins/content/default/content.css"],emoticons_database_url:"tinymce/plugins/emoticons/js/emojis.js",images_upload_handler:function(e,t,n){console.log(e)},plugins:"insertdatetime lists advlist image link preview emoticons hr searchreplace table wordcount codesample",toolbar:"undo redo | formatselect | forecolor backcolor | bold italic underline strikethrough blockquote codesample | image link table emoticons hr insertdatetime | alignleft aligncenter alignright alignjustify | bullist numlist | outdent indent | wordcount | searchreplace| preview",branding:!0}}},watch:{content:function(e,t){this.content=e}},methods:{}}),l=i,s=n("2877"),c=Object(s["a"])(l,o,a,!1,null,"18d252a8",null);t["a"]=c.exports},3123:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var o=n("b775");function a(){return Object(o["a"])({url:"/api/qiniu/token",method:"get"})}function r(e){return Object(o["a"])({url:"/api/qiniu/del",method:"get",params:{filename:e}})}},"65e5":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return r}));n("34ef"),n("4917"),n("28a5"),n("7f7f");function o(e){var t=new FileReader;return t.readAsDataURL(e),new Promise((function(n,o){t.onloadend=function(t){var o=t.target.result,r=(t.total,new Image);r.src=o,r.onload=function(){e=a(r,e.name),n(e)}}}))}function a(e,t){var n=document.createElement("canvas"),a=n.getContext("2d"),i=e.width/2,l=e.height/2;n.width=i,n.height=l,a.drawImage(e,0,0,i,l);var s=n.toDataURL("image/jpeg",.5),c=r(s,t);return o(c),c}function r(e,t){var n=e.split(","),o=n[0].match(/:(.*?);/)[1],a=atob(n[1]),r=a.length,i=new Uint8Array(r);while(r--)i[r]=a.charCodeAt(r);return new File([i],t,{type:o})}},"816e":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("mavon-editor",{ref:"md",on:{imgAdd:e.imgAdd,change:e.getHtmlData},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)},a=[],r=n("b2d8"),i=(n("64e1"),{components:{mavonEditor:r["mavonEditor"]},data:function(){return{content:""}},methods:{imgAdd:function(e,t){this.$emit("imgAdd",e,t)},getHtmlData:function(e,t){this.$emit("getHtmlData",e,t)}}}),l=i,s=n("2877"),c=Object(s["a"])(l,o,a,!1,null,"7e63ae5d",null);t["a"]=c.exports},b0a8:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"id",hidden:""}},[n("el-input",{model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"标题"}},[n("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"分类"}},[n("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"内容"}},[n("markdown",{ref:"con",on:{imgAdd:e.imgAdd,getHtmlData:e.getHtmlData}})],1),e._v(" "),n("el-form-item",{attrs:{label:"时间",prop:"date"}},[n("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"封面图"}},[n("el-upload",{staticClass:"upload-demo",attrs:{"http-request":e.handleUpload,"on-remove":e.handleRemove,"on-exceed":e.handleExceed,"list-type":"picture-card",action:"","file-list":e.oldimg,limit:1}},[n("i",{staticClass:"el-icon-plus"})]),e._v("\n      "+e._s(this.newimg)+"\n      "),e._v(" "),n("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.jindu}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"success"},on:{click:function(t){return e.onSubmit()}}},[e._v("点击修改")])],1)],1)],1)},a=[],r=(n("ac6a"),n("96cf"),n("1da1")),i=(n("a481"),n("7f7f"),n("bc3a")),l=n.n(i),s=n("24d7"),c=n("816e"),m=n("2423"),u=n("3123"),d=n("65e5"),g=(n("cea2"),{components:{tinymce1:s["a"],markdown:c["a"]},data:function(){return{form:{id:"",title:"",type:"",content:"",content_html:"",date:"",img:null,catalog:[]},oldimg:[],newimg:null,rules:{date:[{required:!0,message:"请填写日期时间"}]},token:"",jindu:0}},mouted:function(){},created:function(){var e=this;Object(m["e"])(this.$route.params.id).then((function(t){console.log(t,e.$store.state.user.role),e.form.id=t.data.rows[0].id,e.form.title=t.data.rows[0].title,e.form.type=t.data.rows[0].type,e.$refs["con"].content=t.data.rows[0].content,e.form.date=t.data.rows[0].createtime,e.form.date=e.dateFormat(e.form.date),t.data.rows[0].img&&(console.log("121111111111111"),e.oldimg.push({name:t.data.rows[0].img,url:t.data.rows[0].img}),console.log(e.oldimg[0].url),e.newimg=t.data.rows[0].img,console.log("==========="))})).catch((function(e){console.log(e)}))},methods:{imgAdd:function(e,t){var n=this;new FormData;console.log("pos",e,t,this.form.content),Object(d["b"])(t).then((function(o){n.newimg=o,Object(u["b"])().then((function(e){console.log("获取七牛云上传凭证成功！"),n.token=e,console.log(e)})).then((function(){var o=new FormData;o.append("file",t),o.append("key",t.type+"/"+n.newimg.name),o.append("token",n.token),console.log(n.newimg),console.log("原本没有封面图的不用删直接上传新封面图，再修改数据库"),n.form.img="http://img.nanwayan.cn/"+n.newimg.name,l.a.post("http://upload-z2.qiniup.com",o).then((function(t){n.$refs.con.$refs.md.$img2Url(e,t.data.url)}))}))}))},dateFormat:function(e){var t=new Date(e),n=t.getFullYear(),o=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,a=t.getDate()<10?"0"+t.getDate():t.getDate(),r=t.getHours()<10?"0"+t.getHours():t.getHours(),i=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),l=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return n+"-"+o+"-"+a+" "+r+":"+i+":"+l},getHtmlData:function(e,t){this.form.content_html=this.$refs["con"].content.replace(/\'/g,'"'),this.form.content_html=t,console.log("this.form.content: ",this.form.content)},handleUpload:function(e){var t=new FormData;t.append("file",e),console.log(t),this.newimg=e.file},handleRemove:function(){this.newimg=null},handleExceed:function(){this.$message({message:"只能上传一张封面图",type:"error"})},editarticle:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("开始修改文章"),console.log(this.$refs.form.model),e.next=4,Object(m["d"])(t);case 4:n=e.sent,console.log(n),console.log("修改文章完成！"),this.$message({message:n.message,type:"success"});case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),editImg:function(){var e=this;Object(d["b"])(this.newimg).then((function(t){e.newimg=t,console.log("22222222222222"),Object(u["b"])().then((function(t){console.log("获取七牛云上传凭证成功！"),e.token=t,console.log(t)})).then((function(){var t=new FormData;t.append("file",e.newimg),t.append("key",e.newimg.name),t.append("token",e.token),console.log(e.newimg),console.log,console.log("原本没有封面图的不用删直接上传新封面图，再修改数据库"),e.form.img="http://img.nanwayan.cn/"+e.newimg.name,l.a.post("http://upload-z2.qiniup.com",t),e.editarticle(e.form)}))}))},onSubmit:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n,o,a,i,l,s,c,m=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(this.form.content=this.$refs["con"].content.replace(/\'/g,'"'),t=document.getElementsByClassName("v-show-content")[0].children,n=[],o=0,a=["H1","H2","H3","H4","H5","H6"],i=0;i<t.length;i++)console.log(t[i].tagName,a.indexOf(t[i].tagName>0)),a.indexOf(t[i].tagName)>=0&&(o++,n.push({id:t[i].firstChild.id,title:t[i].innerText,deep:parseInt(t[i].tagName.replace("H","")),index:o}));l=[],s=0,c=0,n.forEach((function(e){e.children=[],0==l.length?(e.tag=s+ ++c+".",l.push(e)):e.deep<=l[l.length-1].deep?l.push(e):l[l.length-1].children.push(e)})),console.log(l),this.form.catalog=l,this.$refs["form"].validate(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=21;break}if(console.log("表单验证通过！",m.$store.state.user.role),"admin"==m.$store.state.user.role){e.next=6;break}m.$message({message:"您没权限修改哦~",type:"warning"}),e.next=19;break;case 6:if(0!=m.oldimg.length){e.next=10;break}null!=m.newimg?(console.log("无封面",m.newimg),m.editImg()):(console.log("有风吗"),console.log("111111111"),m.form.img=null,m.editarticle(m.form)),e.next=19;break;case 10:if(console.log("sssssssssssssss"),console.log(m.oldimg[0].name),console.log(m.newimg),null!=m.newimg){e.next=18;break}return console.log("如果只删除七牛云图片，除了修改数据库还要把七牛云图片删了"),m.form.img=null,m.editarticle(m.form),e.abrupt("return");case 18:m.oldimg[0].name!=m.newimg?(console.log("xiu改封面",m.newimg),m.editImg()):(console.log("sdfsdgd"),console.log(m.oldimg[0].name),m.form.img=m.oldimg[0].name,m.editarticle(m.form));case 19:e.next=23;break;case 21:return alert("请填写完整！"),e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}}),f=g,p=n("2877"),h=Object(p["a"])(f,o,a,!1,null,null,null);t["default"]=h.exports}}]);