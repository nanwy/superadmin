(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c7e0f73"],{2423:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return r})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return s}));var a=n("b775");function o(e,t){return Object(a["a"])({url:"/api/blog/list",method:"get",params:{ordername:e,orderby:t}})}function i(e,t){return Object(a["a"])({url:"/api/blog/detail",method:"get",params:{id:e,title:t}})}function r(e){return Object(a["a"])({url:"/api/blog/new",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/api/blog/update",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/api/blog/del",method:"get",params:{id:e}})}},"24d7":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("tinymceeditor",{attrs:{init:e.init},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)},o=[],i=(n("e562"),n("ca72")),r=(n("4ea8"),n("4237"),n("84ec"),n("0902"),n("0a9d"),n("69e4"),n("2b07"),n("62e5"),n("07d1"),n("9434"),n("07d7"),n("4bd0"),{components:{tinymceeditor:i["a"]},data:function(){return{content:"",init:{language_url:"/tinymce/zh_CN.js",language:"zh_CN",theme_url:"/tinymce/themes/silver/theme.min.js",skin_url:"/tinymce/skins/ui/oxide",height:300,content_css:["/tinymce/skins/content/default/content.css"],emoticons_database_url:"tinymce/plugins/emoticons/js/emojis.js",images_upload_handler:function(e,t,n){console.log(e)},plugins:"insertdatetime lists advlist image link preview emoticons hr searchreplace table wordcount codesample",toolbar:"undo redo | formatselect | forecolor backcolor | bold italic underline strikethrough blockquote codesample | image link table emoticons hr insertdatetime | alignleft aligncenter alignright alignjustify | bullist numlist | outdent indent | wordcount | searchreplace| preview",branding:!0}}},watch:{content:function(e,t){this.content=e}},methods:{}}),l=r,s=n("2877"),c=Object(s["a"])(l,a,o,!1,null,"18d252a8",null);t["a"]=c.exports},3123:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));var a=n("b775");function o(){return Object(a["a"])({url:"/api/qiniu/token",method:"get"})}function i(e){return Object(a["a"])({url:"/api/qiniu/del",method:"get",params:{filename:e}})}},"65e5":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));n("34ef"),n("4917"),n("28a5"),n("7f7f");function a(e){var t=new FileReader;return t.readAsDataURL(e),new Promise((function(n,a){t.onloadend=function(t){var a=t.target.result,i=(t.total,new Image);i.src=a,i.onload=function(){e=o(i,e.name),n(e)}}}))}function o(e,t){var n=document.createElement("canvas"),o=n.getContext("2d"),r=e.width/2,l=e.height/2;n.width=r,n.height=l,o.drawImage(e,0,0,r,l);var s=n.toDataURL("image/jpeg",.5),c=i(s,t);return a(c),c}function i(e,t){var n=e.split(","),a=n[0].match(/:(.*?);/)[1],o=atob(n[1]),i=o.length,r=new Uint8Array(i);while(i--)r[i]=o.charCodeAt(i);return new File([r],t,{type:a})}},"6c89":function(e,t,n){"use strict";var a=n("e191"),o=n.n(a);o.a},"816e":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("mavon-editor",{ref:"md",on:{imgAdd:e.imgAdd,change:e.getHtmlData},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)},o=[],i=n("b2d8"),r=(n("64e1"),{components:{mavonEditor:i["mavonEditor"]},data:function(){return{content:"",subfield:!0}},methods:{imgAdd:function(e,t){this.$emit("imgAdd",e,t)},getHtmlData:function(e,t){this.$emit("getHtmlData",e,t)}}}),l=r,s=(n("6c89"),n("2877")),c=Object(s["a"])(l,a,o,!1,null,"28998b4e",null);t["a"]=c.exports},b0a8:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-form",{ref:"data",attrs:{model:e.data,rules:e.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"id",hidden:""}},[n("el-input",{model:{value:e.data.id,callback:function(t){e.$set(e.data,"id",t)},expression:"data.id"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"标题"}},[n("el-input",{model:{value:e.data.title,callback:function(t){e.$set(e.data,"title",t)},expression:"data.title"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"标签"}},[n("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},e._l(e.list,(function(t){return n("el-option",{key:t.id,attrs:{value:t.title},nativeOn:{click:function(n){return e.selectId(t.id)}}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"内容"}},[n("markdown",{ref:"con",on:{imgAdd:e.imgAdd,getHtmlData:e.getHtmlData}})],1),e._v(" "),n("el-form-item",{attrs:{label:"时间",prop:"date"}},[n("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:e.data.date,callback:function(t){e.$set(e.data,"date",t)},expression:"data.date"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"封面图"}},[n("el-upload",{staticClass:"upload-demo",attrs:{"http-request":e.handleUpload,"on-remove":e.handleRemove,"on-exceed":e.handleExceed,"list-type":"picture-card",action:"","file-list":e.oldimg,limit:1}},[n("i",{staticClass:"el-icon-plus"})]),e._v("\n      "+e._s(this.newimg)+"\n      "),e._v(" "),n("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.jindu}})],1),e._v(" "),n("el-form-item",{staticClass:"submit"},[n("el-button",{attrs:{type:"success"},on:{click:function(t){return e.onSubmit()}}},[e._v("点击修改")])],1)],1)],1)},o=[],i=(n("96cf"),n("1da1")),r=(n("a481"),n("7f7f"),n("ac6a"),n("bc3a")),l=n.n(r),s=n("24d7"),c=n("816e"),d=n("2423"),u=n("3123"),m=n("65e5"),g=(n("cea2"),n("d28d")),f={components:{tinymce1:s["a"],markdown:c["a"]},data:function(){return{data:{id:"",title:"",type:"",content:"",content_html:"",date:"",img:null,catalog:[],tags:[]},list:[],tags:"",oldimg:[],newimg:null,rules:{date:[{required:!0,message:"请填写日期时间"}]},token:"",jindu:0}},mouted:function(){},created:function(){var e=this;Object(g["b"])().then((function(t){e.list=t.data.rows,console.log("this.list : ",e.list)})),Object(d["e"])(this.$route.params.id).then((function(t){console.log(t,e.$store.state.user.role),t.data[0].tags.forEach((function(t){e.tags.push(t.title)})),console.log("this.tags: ",e.tags),e.data.id=t.data[0].id,e.data.title=t.data[0].title,e.data.type=t.data[0].type,e.$refs["con"].content=t.data[0].content,e.data.date=t.data[0].createtime,e.data.date=e.dateFormat(e.data.date),t.data[0].img&&(console.log("121111111111111"),e.oldimg.push({name:t.data[0].img,url:t.data[0].img}),console.log(e.oldimg[0].url),e.newimg=t.data[0].img,console.log("==========="))})).catch((function(e){console.log(e)}))},methods:{selectId:function(e){console.log("点击",e),this.data.tags.push(e)},treeify:function(e){var t=this,n=[],a=0,o=0;return e.forEach((function(e){e.children=[],0==n.length?(e.tag=a+ ++o+".",n.push(e),console.log(n)):e.deep<=n[n.length-1].deep?(e.tag=a+ ++o+".",n.push(e)):n[n.length-1].children.push(e)})),n.forEach((function(e){var n=[];o=0,e.children.forEach((function(e){e.tag=a+ ++o+".",-1===n.indexOf(e.deep)&&n.push(e.deep)})),n.length>1&&(e.children=t.treeify(e.children))})),console.log(e),n},imgAdd:function(e,t){var n=this;new FormData;console.log("pos",e,t,this.data.content),Object(m["b"])(t).then((function(a){n.newimg=a,Object(u["b"])().then((function(e){console.log("获取七牛云上传凭证成功！"),n.token=e,console.log(e)})).then((function(){var a=new FormData;a.append("file",t),a.append("key",t.type+"/"+n.newimg.name),a.append("token",n.token),console.log(n.newimg),console.log("原本没有封面图的不用删直接上传新封面图，再修改数据库"),n.data.img="http://img.nanwayan.cn/"+n.newimg.name,l.a.post("http://upload-z2.qiniup.com",a).then((function(t){n.$refs.con.$refs.md.$img2Url(e,t.data.url)}))}))}))},dateFormat:function(e){var t=new Date(e),n=t.getFullYear(),a=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,o=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getHours()<10?"0"+t.getHours():t.getHours(),r=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),l=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return n+"-"+a+"-"+o+" "+i+":"+r+":"+l},getHtmlData:function(e,t){this.data.content_html=this.$refs["con"].content.replace(/\'/g,'"'),this.data.content_html=t},handleUpload:function(e){var t=new FormData;t.append("file",e),console.log(t),this.newimg=e.file},handleRemove:function(){this.newimg=null},handleExceed:function(){this.$message({message:"只能上传一张封面图",type:"error"})},editarticle:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("开始修改文章"),console.log(this.$refs.data.model),e.next=4,Object(d["d"])(t);case 4:n=e.sent,console.log(n),console.log("修改文章完成！"),this.$message({message:n.message,type:"success"});case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),editImg:function(){var e=this;Object(m["b"])(this.newimg).then((function(t){e.newimg=t,console.log("22222222222222"),Object(u["b"])().then((function(t){console.log("获取七牛云上传凭证成功！"),e.token=t,console.log(t)})).then((function(){var t=new FormData;t.append("file",e.newimg),t.append("key",e.newimg.name),t.append("token",e.token),console.log(e.newimg),console.log,console.log("原本没有封面图的不用删直接上传新封面图，再修改数据库"),e.data.img="http://img.nanwayan.cn/"+e.newimg.name,l.a.post("http://upload-z2.qiniup.com",t),e.editarticle(e.data)}))}))},onSubmit:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n,a,o,r,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(this.data.content=this.$refs["con"].content.replace(/\'/g,'"'),t=document.getElementsByClassName("v-show-content")[0].children,n=[],a=0,o=["H1","H2","H3","H4","H5","H6"],r=0;r<t.length;r++)console.log(t[r].tagName,o.indexOf(t[r].tagName>0)),o.indexOf(t[r].tagName)>=0&&(a++,n.push({id:t[r].firstChild.id,title:t[r].innerText,deep:parseInt(t[r].tagName.replace("H","")),index:a}));return e.next=8,this.treeify(n);case 8:this.data.catalog=e.sent,this.$refs["data"].validate(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=21;break}if(console.log("表单验证通过！",l.$store.state.user.role),"admin"==l.$store.state.user.role){e.next=6;break}l.$message({message:"您没权限修改哦~",type:"warning"}),e.next=19;break;case 6:if(0!=l.oldimg.length){e.next=10;break}null!=l.newimg?(console.log("无封面",l.newimg),l.editImg()):(console.log("有风吗"),console.log("111111111"),l.data.img=null,l.editarticle(l.data)),e.next=19;break;case 10:if(console.log("sssssssssssssss"),console.log(l.oldimg[0].name),console.log(l.newimg),null!=l.newimg){e.next=18;break}return console.log("如果只删除七牛云图片，除了修改数据库还要把七牛云图片删了"),l.data.img=null,l.editarticle(l.data),e.abrupt("return");case 18:l.oldimg[0].name!=l.newimg?(console.log("xiu改封面",l.newimg),l.editImg()):(console.log("sdfsdgd"),console.log(l.oldimg[0].name),l.data.img=l.oldimg[0].name,l.editarticle(l.data));case 19:e.next=23;break;case 21:return alert("请填写完整！"),e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},h=f,p=(n("ee8f"),n("2877")),b=Object(p["a"])(h,a,o,!1,null,"38ea42ac",null);t["default"]=b.exports},d279:function(e,t,n){},d28d:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var a=n("b775");function o(e){return Object(a["a"])({url:"/api/tag/add",method:"post",data:e})}function i(){return Object(a["a"])({url:"/api/tag/list",method:"get"})}},e191:function(e,t,n){},ee8f:function(e,t,n){"use strict";var a=n("d279"),o=n.n(a);o.a}}]);