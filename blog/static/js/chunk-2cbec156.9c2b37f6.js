(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2cbec156"],{2423:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"e",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return c})),n.d(e,"c",(function(){return s}));var o=n("b775");function a(t,e){return Object(o["a"])({url:"/api/blog/list",method:"get",params:{ordername:t,orderby:e}})}function i(t,e){return Object(o["a"])({url:"/api/blog/detail",method:"get",params:{id:t,title:e}})}function r(t){return Object(o["a"])({url:"/api/blog/new",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/api/blog/update",method:"post",data:t})}function s(t){return Object(o["a"])({url:"/api/blog/del",method:"get",params:{id:t}})}},"24d7":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("tinymceeditor",{attrs:{init:t.init},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)},a=[],i=(n("e562"),n("ca72")),r=(n("4ea8"),n("4237"),n("84ec"),n("0902"),n("0a9d"),n("69e4"),n("2b07"),n("62e5"),n("07d1"),n("9434"),n("07d7"),n("4bd0"),{components:{tinymceeditor:i["a"]},data:function(){return{content:"",init:{language_url:"/tinymce/zh_CN.js",language:"zh_CN",theme_url:"/tinymce/themes/silver/theme.min.js",skin_url:"/tinymce/skins/ui/oxide",height:300,content_css:["/tinymce/skins/content/default/content.css"],emoticons_database_url:"tinymce/plugins/emoticons/js/emojis.js",images_upload_handler:function(t,e,n){console.log(t)},plugins:"insertdatetime lists advlist image link preview emoticons hr searchreplace table wordcount codesample",toolbar:"undo redo | formatselect | forecolor backcolor | bold italic underline strikethrough blockquote codesample | image link table emoticons hr insertdatetime | alignleft aligncenter alignright alignjustify | bullist numlist | outdent indent | wordcount | searchreplace| preview",branding:!0}}},watch:{content:function(t,e){this.content=t}},methods:{}}),c=r,s=n("2877"),l=Object(s["a"])(c,o,a,!1,null,"18d252a8",null);e["a"]=l.exports},3123:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return i}));var o=n("b775");function a(){return Object(o["a"])({url:"/api/qiniu/token",method:"get"})}function i(t){return Object(o["a"])({url:"/api/qiniu/del",method:"get",params:{filename:t}})}},3846:function(t,e,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},"5dbc":function(t,e,n){var o=n("d3f4"),a=n("8b97").set;t.exports=function(t,e,n){var i,r=e.constructor;return r!==n&&"function"==typeof r&&(i=r.prototype)!==n.prototype&&o(i)&&a&&a(t,i),t}},"65e5":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return i}));n("34ef"),n("4917"),n("28a5"),n("7f7f");function o(t){var e=new FileReader;return e.readAsDataURL(t),new Promise((function(n,o){e.onloadend=function(e){var o=e.target.result,i=(e.total,new Image);i.src=o,i.onload=function(){t=a(i,t.name),n(t)}}}))}function a(t,e){var n=document.createElement("canvas"),a=n.getContext("2d"),r=t.width/2,c=t.height/2;n.width=r,n.height=c,a.drawImage(t,0,0,r,c);var s=n.toDataURL("image/jpeg",.5),l=i(s,e);return o(l),l}function i(t,e){var n=t.split(","),o=n[0].match(/:(.*?);/)[1],a=atob(n[1]),i=a.length,r=new Uint8Array(i);while(i--)r[i]=a.charCodeAt(i);return new File([r],e,{type:o})}},"6b54":function(t,e,n){"use strict";n("3846");var o=n("cb7c"),a=n("0bfb"),i=n("9e1e"),r="toString",c=/./[r],s=function(t){n("2aba")(RegExp.prototype,r,t,!0)};n("79e5")((function(){return"/a/b"!=c.call({source:"a",flags:"b"})}))?s((function(){var t=o(this);return"/".concat(t.source,"/","flags"in t?t.flags:!i&&t instanceof RegExp?a.call(t):void 0)})):c.name!=r&&s((function(){return c.call(this)}))},"6c89":function(t,e,n){"use strict";var o=n("e191"),a=n.n(o);a.a},"733d":function(t,e,n){},7514:function(t,e,n){"use strict";var o=n("5ca1"),a=n("0a49")(5),i="find",r=!0;i in[]&&Array(1)[i]((function(){r=!1})),o(o.P+o.F*r,"Array",{find:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(i)},"767f":function(t,e,n){"use strict";var o=n("733d"),a=n.n(o);a.a},"816e":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("mavon-editor",{ref:"md",on:{imgAdd:t.imgAdd,change:t.getHtmlData},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)},a=[],i=n("b2d8"),r=(n("64e1"),{components:{mavonEditor:i["mavonEditor"]},data:function(){return{content:"",subfield:!0}},methods:{imgAdd:function(t,e){this.$emit("imgAdd",t,e)},getHtmlData:function(t,e){this.$emit("getHtmlData",t,e)}}}),c=r,s=(n("6c89"),n("2877")),l=Object(s["a"])(c,o,a,!1,null,"28998b4e",null);e["a"]=l.exports},"8b97":function(t,e,n){var o=n("d3f4"),a=n("cb7c"),i=function(t,e){if(a(t),!o(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,o){try{o=n("9b43")(Function.call,n("11e9").f(Object.prototype,"__proto__").set,2),o(t,[]),e=!(t instanceof Array)}catch(a){e=!0}return function(t,n){return i(t,n),e?t.__proto__=n:o(t,n),t}}({},!1):void 0),check:i}},a486:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("el-form",{ref:"data",attrs:{model:t.data,rules:t.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"标题",prop:"title"}},[n("el-input",{model:{value:t.data.title,callback:function(e){t.$set(t.data,"title",e)},expression:"data.title"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"标签"}},[n("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.tags,callback:function(e){t.tags=e},expression:"tags"}},t._l(t.list,(function(e){return n("el-option",{key:e.id,attrs:{value:e.title},nativeOn:{click:function(n){return t.selectId(e.id)}}})})),1)],1),t._v(" "),n("el-form-item",{attrs:{label:"内容"}},[n("markdown",{ref:"con",on:{imgAdd:t.imgAdd,getHtmlData:t.getHtmlData}})],1),t._v(" "),n("el-form-item",{attrs:{label:"时间",prop:"date"}},[n("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:t.data.date,callback:function(e){t.$set(t.data,"date",e)},expression:"data.date"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"封面图"}},[n("el-upload",{staticClass:"upload-demo",attrs:{"http-request":t.handleUpload,"on-remove":t.handleRemove,"on-exceed":t.handleExceed,action:"","list-type":"picture-card",limit:1}},[n("i",{staticClass:"el-icon-plus"})]),t._v(" "),n("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.jindu}})],1),t._v(" "),n("el-button",{staticClass:"submit",attrs:{type:"success"},on:{click:function(e){return t.onSubmit()}}},[t._v("发表文章")])],1)],1)},a=[],i=(n("c5f6"),n("96cf"),n("1da1")),r=(n("ac6a"),n("6b54"),n("a481"),n("7f7f"),n("7514"),n("2423")),c=n("3123"),s=n("d28d"),l=n("65e5"),u=n("bc3a"),d=n.n(u),f=n("cea2"),g=n("24d7"),m=n("816e"),p={components:{tinymce:g["a"],markdown:m["a"]},data:function(){return{token:"",jindu:0,data:{title:"",type:"",content:"",content_html:"",date:"",img:null,catalog:[],tags:[]},list:[],tags:"",rules:{title:[{required:!0,message:"请填写标题！"}],type:[{required:!0,message:"请填写分类!"}],date:[{required:!0,message:"请填写日期时间！"}]}}},created:function(){var t=this;console.log(l["a"],l["b"],"发布"),Object(s["b"])().then((function(e){t.list=e.data.rows,console.log("this.list : ",t.list)}))},mouted:function(){},methods:{showMessage:function(t){console.log(t);var e=this.list.find((function(e){return e.title=t}));console.log(e),this.data.tags.push(e.id),console.log("this.data.tags: ",this.data.tags)},selectId:function(t){console.log("点击",t),this.data.tags.push(t)},imgAdd:function(t,e){var n=this;new FormData;console.log("pos",t,e,this.data.content),Object(l["b"])(e).then((function(o){n.newimg=o,Object(c["b"])().then((function(t){console.log("获取七牛云上传凭证成功！"),n.token=t,console.log(t)})).then((function(){var o=new FormData;o.append("file",e),o.append("key",e.type+"/"+n.newimg.name),o.append("token",n.token),console.log(n.newimg),console.log("原本没有封面图的不用删直接上传新封面图，再修改数据库"),n.data.img="http://img.nanwayan.cn/"+n.newimg.name,d.a.post("http://upload-z2.qiniup.com",o).then((function(e){n.$refs.con.$refs.md.$img2Url(t,e.data.url)}))}))}))},getHtmlData:function(t,e){this.data.content_html=this.$refs["con"].content.replace(/\'/g,'"'),this.data.content_html=e,console.log("this.data.content: ",this.data.content)},handleUpload:function(t){this.data.img=t.file,console.log(t.file)},handleRemove:function(){this.data.img=null},handleExceed:function(){this.$message({message:"只能上传一张封面图",type:"error"})},treeify:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){var e=[],n=0,o=0;return t.forEach((function(t){t.children=[],0==e.length?(t.tag=n+ ++o+".",e.push(t),console.log(e)):t.deep<=e[e.length-1].deep?(t.tag=n+ ++o+".",e.push(t)):e[e.length-1].children.push(t),e.forEach((function(t){var e=[],o=0;t.children.forEach((function(t){t.tag=n+ ++o+"."})),e.length>1&&(t.children=treeify(t.children))}))})),e})),onSubmit:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,n,o,a,i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(this.data.content=this.$refs["con"].content.replace(/\'/g,'"'),console.log(this.$store.state.user.role),e=document.getElementsByClassName("v-show-content")[0].children,n=[],o=0,a=["H1","H2","H3","H4","H5","H6"],i=0;i<e.length;i++)a.indexOf(e[i].tagName)>=0&&(o++,n.push({id:e[i].firstChild.id,title:e[i].innerText,deep:parseInt(e[i].tagName.replace("H","")),index:o}),console.log(n));return t.next=9,this.treeify(n);case 9:this.data.catalog=t.sent,this.$refs["data"].validate((function(t){if(!t)return alert("请填写完整！"),!1;console.log("表单验证通过！"),"admin"!==s.$store.state.user.role?s.$message({message:"您没权限发送哦~",type:"warning"}):(console.log("daozhel",s.data.img),null==s.data.img?(console.log("没有封面图"),console.log(s.data),Object(r["a"])(s.data).then((function(t){console.log(t.errno),console.log(t),s.$message({message:"发布成功啦!",type:"success"})})).catch((function(t){console.log("发布文章错误"),console.log(t)}))):Object(l["b"])(s.data.img).then((function(t){console.log("res as,nflasjflaskkjflasfj奥数班看见爱上",t),s.data.img=t,console.log("有封面图"),Object(c["b"])().then((function(t){console.log("获取七牛云上传凭证成功！"),s.token=t})).then((function(){var t=new Date,e=t.getTime()+s.data.img.name;console.log(s.data);var n=s.token,o={fname:"",params:{},mimeType:["image/png","image/jpeg","image/gif"]},a={useCdnDomain:!0},i=s,c=f["upload"](s.data.img,e,n,o,a);console.log(c);var l=c.subscribe({next:function(t){console.log(t);var e=t.total.percent;i.jindu=e.toFixed(),i.jindu=Number(i.jindu)},error:function(t){console.log(l),console.log("上传错误"),console.log(t),console.log("上传错误！发表文章"),Object(r["a"])(i.data).then((function(t){i.$message({message:"发布成功",type:"success"})})).catch((function(t){console.log("发布文章错误"),console.log(t)}))},complete:function(t){console.log("上传封面图成功！"),i.data.img="http://img.nanwayan.cn/"+t.key,console.log(i.data),Object(r["a"])(i.data).then((function(t){console.log("发布文章成功！"),i.$message({message:t,type:"success"})})).catch((function(t){console.log("发布文章失败！"),console.log(t)}))}})})).catch((function(t){console.log("获取七牛云上传凭证失败！"),console.log(t)}))})))}));case 11:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},h=p,b=(n("767f"),n("2877")),v=Object(b["a"])(h,o,a,!1,null,null,null);e["default"]=v.exports},aa77:function(t,e,n){var o=n("5ca1"),a=n("be13"),i=n("79e5"),r=n("fdef"),c="["+r+"]",s="​",l=RegExp("^"+c+c+"*"),u=RegExp(c+c+"*$"),d=function(t,e,n){var a={},c=i((function(){return!!r[t]()||s[t]()!=s})),l=a[t]=c?e(f):r[t];n&&(a[n]=l),o(o.P+o.F*c,"String",a)},f=d.trim=function(t,e){return t=String(a(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(u,"")),t};t.exports=d},c5f6:function(t,e,n){"use strict";var o=n("7726"),a=n("69a8"),i=n("2d95"),r=n("5dbc"),c=n("6a99"),s=n("79e5"),l=n("9093").f,u=n("11e9").f,d=n("86cc").f,f=n("aa77").trim,g="Number",m=o[g],p=m,h=m.prototype,b=i(n("2aeb")(h))==g,v="trim"in String.prototype,y=function(t){var e=c(t,!1);if("string"==typeof e&&e.length>2){e=v?e.trim():f(e,3);var n,o,a,i=e.charCodeAt(0);if(43===i||45===i){if(n=e.charCodeAt(2),88===n||120===n)return NaN}else if(48===i){switch(e.charCodeAt(1)){case 66:case 98:o=2,a=49;break;case 79:case 111:o=8,a=55;break;default:return+e}for(var r,s=e.slice(2),l=0,u=s.length;l<u;l++)if(r=s.charCodeAt(l),r<48||r>a)return NaN;return parseInt(s,o)}}return+e};if(!m(" 0o1")||!m("0b1")||m("+0x1")){m=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof m&&(b?s((function(){h.valueOf.call(n)})):i(n)!=g)?r(new p(y(e)),n,m):y(e)};for(var _,w=n("9e1e")?l(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),j=0;w.length>j;j++)a(p,_=w[j])&&!a(m,_)&&d(m,_,u(p,_));m.prototype=h,h.constructor=m,n("2aba")(o,g,m)}},d28d:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return i}));var o=n("b775");function a(t){return Object(o["a"])({url:"/api/tag/add",method:"post",data:t})}function i(){return Object(o["a"])({url:"/api/tag/list",method:"get"})}},e191:function(t,e,n){},fdef:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);